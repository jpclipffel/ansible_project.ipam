# code: language=Ansible insertSpaces=true tabSize=2

- name: Notify by mail
  hosts: localhost
  gather_facts: no
  tasks:

    - name: Notify - Query
      mail:
        host: smtp.dt.ept.lu
        port: 25
        subject: "[IPAM] - {{ notify_resource | default('Unknown kind') }} query - {{ notify_status | default('Unknown status') }}"
        body: "{{ lookup('template', '../templates/mail_notification.html.j2') }}"
        from: ansible@post.lu
        to: ["{{ tower_user_email }}"]
        charset: "utf-8" 
        subtype: "html"
      when:
        - "tower_user_email | default('') | length > 0"
      delegate_to: localhost
      run_once: yes
      tags: [never, query]

    - name: Notify - Setup
      mail:
        host: smtp.dt.ept.lu
        port: 25
        subject: "[IPAM] - {{ notify_resource | default('Unknown kind') }} setup - {{ notify_status | default('Unknown status') }}"
        body: "{{ lookup('template', '../templates/mail_notification.html.j2') }}"
        from: ansible@post.lu
        to: ["{{ tower_user_email }}"]
        charset: "utf-8" 
        subtype: "html"
      when:
        - "tower_user_email | default('') | length > 0"
      delegate_to: localhost
      run_once: yes
      tags: [never, setup]
